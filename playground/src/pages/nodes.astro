---
import { getStoryFragmentNodesBySlug } from "../utils/db/utils";
import { ReactNodesRenderer } from "../components/storykeep/compositor-nodes/ReactNodesRenderer";
import { addNode, addNodes, clearAll } from "../store/nodes";
import AstroNodesRenderer from "../components/storykeep/compositor-nodes/AstroNodesRenderer.astro";
import { getConfig, validateConfig } from "../utils/core/config";
import type { AuthStatus } from "../types";
import Layout from "../../src/layouts/Layout.astro";

const config = await getConfig();
const validation = await validateConfig(config);
if (!validation.isValid || !config) {
  return Astro.redirect("/storykeep/init");
}

const nodes = await getStoryFragmentNodesBySlug(`hello`, false);
if (nodes !== null) {
  clearAll();
  addNode(nodes.tractstackNode);
  addNode(nodes.storyfragmentNode);
  addNodes(nodes.paneNodes);
  addNodes(nodes.paneFragmentNodes);
  addNodes(nodes.flatNodes);
}
---

<Layout title="Nodes" pubDatetime={new Date()} modDatetime={new Date()} config={config}>
  <h1>React</h1>
  <ReactNodesRenderer />
  <h1>Astro</h1>
  <AstroNodesRenderer />

  <h1>Data</h1>
  <pre>
  {JSON.stringify(nodes, null, 2)}
</pre>
</Layout>
