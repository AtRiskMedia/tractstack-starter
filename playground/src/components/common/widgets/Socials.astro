---
import Link from "../nav/Link.astro";
import { socialIcons, socialIconKeys } from "../../../utils/common/socialIcons";

interface Props {
  payload: string;
}

const { payload } = Astro.props;

// Type guard to ensure we have valid social entries
function isSocialEntry(arr: string[]): arr is [string, string] | [string, string, string] {
  return arr.length >= 2 && arr.length <= 3;
}

// Split and filter in one step to ensure type safety
const socials = payload
  .split(`,`)
  .map((s) => s.split(`|`))
  .filter(isSocialEntry);
---

<div class="flex flex-wrap justify-center gap-3">
  {
    socials
      .filter((social) => socialIconKeys.includes(social[0]))
      .map((social) => (
        <Link
          href={social[1]}
          className="my-1 p-2 hover:rotate-6"
          target="_blank"
          title={social[2] ?? social[1]}
        >
          <span class="inline-block h-6 w-6 scale-125 fill-transparent stroke-current stroke-2 opacity-90 group-hover:fill-transparent xs:scale-110">
            <Fragment set:html={socialIcons[social[0] as keyof typeof socialIcons]} />
          </span>
        </Link>
      ))
  }
</div>
